<!DOCTYPE html>
<html>
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">
  <title>page-loop.js | Pagehop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="canonical" href="http://api.pagehopapp.com/page-loop-js/index.html">
  <link rel="shortcut icon" href="/img/favicon.ico">
  <link rel="stylesheet" href="/css/style.css">
  <link href="//fonts.googleapis.com/css?family=Lato:300,700" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css">
  <link rel="alternate" href="/atom.xml" title="Documentation | Pagehop">
  <meta name="description" content="What does it do?The page-loop, as the name suggests, is primarily responsible for determining which urls should be scraped (as a main approach for obtaining data). Once the page-loop determines a url">
<meta property="og:type" content="website">
<meta property="og:title" content="page-loop.js">
<meta property="og:url" content="http://api.pagehopapp.com/page-loop-js/index.html">
<meta property="og:site_name" content="Documentation | Pagehop">
<meta property="og:description" content="What does it do?The page-loop, as the name suggests, is primarily responsible for determining which urls should be scraped (as a main approach for obtaining data). Once the page-loop determines a url">
<meta property="og:image" content="http://api.pagehopapp.com/logo.png">
<meta property="og:updated_time" content="2015-02-24T15:15:57.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="page-loop.js">
<meta name="twitter:description" content="What does it do?The page-loop, as the name suggests, is primarily responsible for determining which urls should be scraped (as a main approach for obtaining data). Once the page-loop determines a url">
<meta name="twitter:image" content="http://api.pagehopapp.com/logo.png">
<meta name="twitter:site" content="@pagehopapp">

  <!-- Bootstrap Core CSS -->
<link href="/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Custom Fonts -->
<link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
<link href="/bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<!-- Custom theme CSS -->
<link href="/pagehopapp-styles/main.css" rel="stylesheet">

  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-53791435-1', 'api.pagehopapp.com');
  ga('send', 'pageview');
</script>

</head>

<body id="page-top">
  <!-- Navigation -->
<nav class="navbar navbar-default navbar-fixed-top">
	<div class="container">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand page-scroll-no-offset" href="#page-top" tabIndex="1">
				<img class="header-logo" src="/img/favicon.ico">
				Pagehop
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav navbar-right">
				<li class="hidden">
					<a href="#page-top"></a>
				</li>
				<li>
					<a href="http://pagehopapp.com"><i class="fa fa-arrow-left"></i></a>
				</li>
				<!-- <li>
					<a href="http://pagehopapp.com/buy">Buy</a>
				</li> -->
				<li>
					<a href="http://api.pagehopapp.com">API</a>
				</li>
				<li>
					<a href="https://medium.com/@pagehop">Blog</a>
				</li>
			</ul>
		</div>
		<!-- /.navbar-collapse -->
	</div>
	<!-- /.container-fluid -->
</nav>
  <article class="page" itemscope itemtype="http://schema.org/Article">
  <header id="page-banner">
    <div class="page-title-outer-container">
      <div id="page-banner-inner" class="inner">
        <h1 id="page-title" itemprop="name">Documentation: page-loop.js</h1>
        <a href="https://github.com/pagehop/api.pagehopapp.com/blob/master/source/page-loop-js.md" title="Improve this doc" id="page-edit-link"></a>
      </div>
    </div>
  </header>
  <div class="outer">
    <div id="mobile-menu-wrap"></div>
    <div class="page-content">
      <div class="toc-wrap">
        <strong class="toc-title">Contents</strong>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#What-does-it-do"><span class="toc-number">1.</span> <span class="toc-text">What does it do?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#How-to-use-external-libs"><span class="toc-number">2.</span> <span class="toc-text">How to use external libs</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#How-long-can-it-run"><span class="toc-number">3.</span> <span class="toc-text">How long can it run?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#What-if-it-fails"><span class="toc-number">4.</span> <span class="toc-text">What if it fails?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Examples"><span class="toc-number">5.</span> <span class="toc-text">Examples</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pagehop-API-page-loop-js"><span class="toc-number">6.</span> <span class="toc-text">pagehop API (page-loop.js)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#pagehop-init-query-options-max-scrapeScript-systemMeta-hops"><span class="toc-number">6.1.</span> <span class="toc-text">pagehop.init(query, options, max, scrapeScript, systemMeta, hops)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pagehop-getMaxCount"><span class="toc-number">6.2.</span> <span class="toc-text">pagehop.getMaxCount()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pagehop-getQuery"><span class="toc-number">6.3.</span> <span class="toc-text">pagehop.getQuery()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pagehop-getOptions"><span class="toc-number">6.4.</span> <span class="toc-text">pagehop.getOptions()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pagehop-getSystemMeta"><span class="toc-number">6.5.</span> <span class="toc-text">pagehop.getSystemMeta()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pagehop-getHops"><span class="toc-number">6.6.</span> <span class="toc-text">pagehop.getHops()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pagehop-scrape-url-callback"><span class="toc-number">6.7.</span> <span class="toc-text">pagehop.scrape( url, callback )</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#experimental-pagehop-updateResults-results"><span class="toc-number">6.8.</span> <span class="toc-text">(experimental) pagehop.updateResults( results )</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pagehop-finishWithError-error"><span class="toc-number">6.9.</span> <span class="toc-text">pagehop.finishWithError( error )</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pagehop-finish-results"><span class="toc-number">6.10.</span> <span class="toc-text">pagehop.finish( results )</span></a></li></ol></li></ol>
      </div>
      <div class="page-entry" itemprop="articleBody">
        <h1 id="What-does-it-do"><a href="#What-does-it-do" class="headerlink" title="What does it do?"></a>What does it do?</h1><p>The page-loop, as the name suggests, is primarily responsible for determining which urls should be scraped (as a main approach for obtaining data).</p>
<p>Once the page-loop determines a url for scraping, it can execute the scrape.js script on this url, using the pagehop.scrape(…) method.</p>
<p>Page-loop might not use a scrape script. If you don’t need to load the page in a browser (you don’t need any scripts to load, content to show-up on an ajax call etc.), you can make requests from the page-loop as well as parse the returned html and scrape results.</p>
<p>If you consume a service - <strong>even better</strong>. Just make the calls from your page-loop.js.</p>
<h1 id="How-to-use-external-libs"><a href="#How-to-use-external-libs" class="headerlink" title="How to use external libs"></a>How to use external libs</h1><p>We’ve built the project structure mimicking the npm module.</p>
<p>As any other module you can use all npm modules as devDependencies for testing purposes (your tests will practically be executed in NodeJS).</p>
<p><strong>Browserify</strong> is used <em>under the hood</em>, so you can take advantage of the increasingly growing range of npm modules that “play well” with browserify, and use these packages as <strong>actual dependencies, inside your scripts</strong>. If you haven’t done that already, please, go through the documentation of <a href="http://browserify.org/" target="_blank" rel="noopener">browserify</a> to see what you can(‘t) do in such a script.</p>
<p>Besides using node packages, page-loop has an access to the <strong>pagehop</strong> global object, which tells you what options did the user selected of your recipe, what was her/his query, how many results can you return and so on.</p>
<p>Before running the page-loop script, the <code>pagehop</code> global object is created, which is similar for both of the scripts (page-loop.js and scrape.js), yet, a bit different.</p>
<h1 id="How-long-can-it-run"><a href="#How-long-can-it-run" class="headerlink" title="How long can it run?"></a>How long can it run?</h1><p>Your recipe will timeout after 30 seconds. Scrape can’t go for longer than 10 seconds (including loading the url), if it does, the callback will return an error with a <code>type</code> prop (saying “timeout”) and a <code>message</code> prop.</p>
<p>If your recipe (page-loop.js being the entry point) times-out, you will see the error in the UI.</p>
<h1 id="What-if-it-fails"><a href="#What-if-it-fails" class="headerlink" title="What if it fails?"></a>What if it fails?</h1><p>If page-loop.js has a syntax error or fails during runtime, your recipe will fail and you will see the error in the UI.</p>
<h1 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h1><p>Here is an example for a recipe <strong>scraping multiple pages</strong> (BingSearch).</p>
<p>This page-loop script starts <strong>n</strong> scrapes, where n = maxCount / 100, maxCount being the max number of results your recipe should return (as in Pagehop-&gt;Settings).</p>
<p>Whenever a scrape finishes:</p>
<ul>
<li>it checks for error:<ul>
<li>if there is one - pagehop.finishWithError( error )</li>
</ul>
</li>
<li>if not:<ul>
<li>process the results</li>
</ul>
</li>
<li>check if all pages have finished<ul>
<li>if they have - pagehop.finish( allResults )</li>
<li>if not - pagehop.updateResults( allResults )</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>),</span><br><span class="line">    deepEqual = <span class="built_in">require</span>(<span class="string">'deep-equal'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> flattenResults = <span class="function"><span class="keyword">function</span>(<span class="params"> results </span>) </span>&#123;...&#125;;</span><br><span class="line"><span class="keyword">var</span> cleanDuplicates = <span class="function"><span class="keyword">function</span>(<span class="params">items</span>) </span>&#123;...&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Query, query, startAt (1 =&gt; 101 =&gt; 201 =&gt; 301...), itemsAtPage</span></span><br><span class="line"><span class="keyword">var</span> urlTemplate = <span class="string">'http://www.bing.com/search?q=%s&amp;pq=%s&amp;first=%s&amp;count=%s'</span>,</span><br><span class="line">    startAt = <span class="number">1</span>,</span><br><span class="line">    itemsAtPage = <span class="number">100</span>,</span><br><span class="line">    max = pagehop.getMaxCount(),</span><br><span class="line">    iterationsCount = <span class="built_in">Math</span>.ceil( max / itemsAtPage ),</span><br><span class="line">    query = pagehop.getQuery(),</span><br><span class="line">    results = <span class="keyword">new</span> <span class="built_in">Array</span>( iterationsCount ),</span><br><span class="line">    asyncCount = iterationsCount;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( query ) &#123;</span><br><span class="line">    <span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="number">0</span>; i &lt; iterationsCount; i++ ) &#123;</span><br><span class="line">        <span class="keyword">var</span> url = util.format(</span><br><span class="line">            urlTemplate,</span><br><span class="line">            <span class="built_in">encodeURIComponent</span>( query ),</span><br><span class="line">            <span class="built_in">encodeURIComponent</span>( query.toLowerCase() ),</span><br><span class="line">            startAt,</span><br><span class="line">            itemsAtPage</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// clojure to preserve i for every result</span></span><br><span class="line">        (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> index = i;</span><br><span class="line">        pagehop.scrape( url, <span class="function"><span class="keyword">function</span>(<span class="params">error, result</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> ( error ) &#123;</span><br><span class="line">                pagehop.finishWithError( error );</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ( result ) &#123;</span><br><span class="line">                results[ index ] = result;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> allResults = cleanDuplicates( flattenResults( results ) );</span><br><span class="line">            <span class="keyword">if</span> ( --asyncCount === <span class="number">0</span> ) &#123;</span><br><span class="line">                pagehop.finish( allResults );</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                pagehop.updateResults( allResults );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; );</span><br><span class="line">        &#125;)();</span><br><span class="line">        startAt += itemsAtPage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    pagehop.finish( [] );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And here is another example of a page-loop (NPMSearch), but this time, consuming a REST-ful JSON API:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>),</span><br><span class="line">    $ = <span class="built_in">window</span>.$;</span><br><span class="line"></span><br><span class="line"><span class="comment">// for tests (to be able to mock jQuery)</span></span><br><span class="line"><span class="keyword">if</span> ( !$ ) &#123;</span><br><span class="line">    <span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'jquery-browserify'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Params:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	rows</span></span><br><span class="line"><span class="comment">//	q (query)</span></span><br><span class="line"><span class="keyword">var</span> searchUrlTemplate = <span class="string">'http://npmsearch.com/query?pretty=true&amp;fl=name,description,version,author,license&amp;rows=%s&amp;sort=rating+desc&amp;q=%s'</span>,</span><br><span class="line">    searchUrlTemplateWithHomePage = <span class="string">'http://npmsearch.com/query?pretty=true&amp;fl=name,description,homepage,version,author,license&amp;rows=%s&amp;sort=rating+desc&amp;q=%s'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> addressUrlTemplate = <span class="string">'https://www.npmjs.org/package/%s'</span>,</span><br><span class="line">    max = pagehop.getMaxCount(),</span><br><span class="line">    query = pagehop.getQuery(),</span><br><span class="line">    options = pagehop.getOptions(),</span><br><span class="line">    isHomePage = ( options !== <span class="literal">null</span> ) &amp;&amp; ( options.indexOf( <span class="string">":h"</span> ) !== <span class="number">-1</span> ),</span><br><span class="line">    results = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> parseItem = <span class="function"><span class="keyword">function</span>(<span class="params">rawItem</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> address;</span><br><span class="line">    <span class="keyword">if</span> ( isHomePage ) &#123;</span><br><span class="line">        address = rawItem.homepage;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        address = util.format(</span><br><span class="line">            addressUrlTemplate,</span><br><span class="line">            rawItem.name</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> displayAddress = [</span><br><span class="line">        <span class="string">"by "</span> + rawItem.author,</span><br><span class="line">        rawItem.version,</span><br><span class="line">        rawItem.license.length ? rawItem.license.join(<span class="string">", "</span>) : <span class="string">"no-license"</span></span><br><span class="line">    ].join( <span class="string">" | "</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result = &#123;</span><br><span class="line">        text: rawItem.name + <span class="string">" ("</span> + rawItem.description + <span class="string">")"</span>,</span><br><span class="line">        displayText: <span class="string">"&lt;b&gt;"</span> + rawItem.name + <span class="string">"&lt;/b&gt;"</span> + <span class="string">" ("</span> + rawItem.description + <span class="string">")"</span>,</span><br><span class="line">        address: address,</span><br><span class="line">        displayAddress: displayAddress</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( !query ) &#123;</span><br><span class="line">    pagehop.finish( [] );</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> url = util.format(</span><br><span class="line">        isHomePage ? searchUrlTemplateWithHomePage : searchUrlTemplate,</span><br><span class="line">        max,</span><br><span class="line">        <span class="built_in">encodeURIComponent</span>( query )</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    $.getJSON( url )</span><br><span class="line">        .done(<span class="function"><span class="keyword">function</span>(<span class="params"> json </span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> items = json.results;</span><br><span class="line">            <span class="keyword">if</span> ( items &amp;&amp; items.length ) &#123;</span><br><span class="line">                results = items.map( parseItem );</span><br><span class="line">            &#125;</span><br><span class="line">            pagehop.finish( results );</span><br><span class="line">        &#125;)</span><br><span class="line">        .fail(<span class="function"><span class="keyword">function</span>(<span class="params"> jqxhr, textStatus, error </span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> err = textStatus + <span class="string">", "</span> + error;</span><br><span class="line">            <span class="built_in">console</span>.log( <span class="string">"Request Failed: "</span> + err );</span><br><span class="line">            pagehop.finishWithError( error );</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In this case, only 1 call to this REST API is enough to get our search results.</p>
<p>There is another significant difference in this example, too - the recipe defines an option - :h (to return results pointing to the homepage of the project instead the default page on npmjs.org).</p>
<p>You can check all available in the API of the <code>pagehop</code> object, bellow.</p>
<h1 id="pagehop-API-page-loop-js"><a href="#pagehop-API-page-loop-js" class="headerlink" title="pagehop API (page-loop.js)"></a>pagehop API (page-loop.js)</h1><h2 id="pagehop-init-query-options-max-scrapeScript-systemMeta-hops"><a href="#pagehop-init-query-options-max-scrapeScript-systemMeta-hops" class="headerlink" title="pagehop.init(query, options, max, scrapeScript, systemMeta, hops)"></a>pagehop.init(query, options, max, scrapeScript, systemMeta, hops)</h2><p>This method is used by Pagehop, to preset the environment for running your page-loop.js</p>
<p>You can use this method only in your tests, where the test framework doesn’t call init automatically.</p>
<p>Lets go through the params:</p>
<ul>
<li><strong>query</strong> - <strong>string</strong>, recipe’s query as parsed by Pagehop.</li>
<li><strong>options</strong> - <strong>array</strong>, holding all options parsed from the pagehop query.</li>
<li><strong>max</strong> - integer, &gt;=10, the maximal number of results that can be returned by the recipe.</li>
<li><strong>scrapeScript</strong> - <strong>string</strong>, Pagehop executes recipes producing a single script which is the page-loop.js with all of it’s dependencies and the scrape script (if any), which is executed in a separate isolated environment upon calling pagehop.scrape() from your page-loop. Since you only should use pagehop.init() in tests, and since these tests should only test the page-loop.js, <strong>never</strong> the scrape.js (it’s separately tested), you don’t need to pass actual script in here, because it shouldn’t get executed.</li>
<li><strong>systemMeta</strong> - <strong>object</strong> with 2 fields (arrays) - <strong>recipes</strong>, <strong>tools</strong>. This is usually used by recipes that provide some system information about Pagehop (AllRecipes list the available recipes and AllTools list the tools).</li>
<li><strong>hops</strong> - <strong>MUTABLE array</strong> of objects specifying addresses the user had “hopped of”. Here is the format of the hop objects:</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    text: <span class="string">"text"</span>,</span><br><span class="line">    address: <span class="string">"address"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="pagehop-getMaxCount"><a href="#pagehop-getMaxCount" class="headerlink" title="pagehop.getMaxCount()"></a>pagehop.getMaxCount()</h2><p>Returns an <strong>integer</strong>. Your pageLoop scripts should get this, in order to find out the limit of the number of returned results they should confirm to.</p>
<h2 id="pagehop-getQuery"><a href="#pagehop-getQuery" class="headerlink" title="pagehop.getQuery()"></a>pagehop.getQuery()</h2><p>Returns a <strong>string</strong>. Returns the recipe query as parsed by Pagehop.</p>
<p>This doesn’t include the whole pagehop query - e.g. in <code>g &lt;this is the query&gt; :r $.*^</code> the parsed query will be <code>&lt;this is the query&gt;</code>.</p>
<h2 id="pagehop-getOptions"><a href="#pagehop-getOptions" class="headerlink" title="pagehop.getOptions()"></a>pagehop.getOptions()</h2><p>Returns an <strong>array</strong> of strings.</p>
<p>Tools or non-recognized options will not be passed in here - e.g. <code>h :s :asdf</code> will produce only [“:s”] for options (“:s” is for Show HN posts with HackerNews recipe).</p>
<h2 id="pagehop-getSystemMeta"><a href="#pagehop-getSystemMeta" class="headerlink" title="pagehop.getSystemMeta()"></a>pagehop.getSystemMeta()</h2><p>Returns an <strong>object</strong> with 2 fields (arrays) - <strong>recipes</strong>, <strong>tools</strong>. Recipe objects look like this (comments show where does the data come from):</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    id: <span class="comment">/* package.json:pagehop.id */</span>,</span><br><span class="line">    description: <span class="comment">/* package.json:description */</span>,</span><br><span class="line">    version: <span class="comment">/* package.json:version */</span>,</span><br><span class="line">    homepage: <span class="comment">/* package.json:homepage */</span>,</span><br><span class="line">    options: <span class="comment">/* package.json:pagehop.options */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Tool objects look like this:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    id: <span class="comment">/* package.json:pagehop.id */</span>,</span><br><span class="line">    description: <span class="comment">/* package.json:description */</span>,</span><br><span class="line">    version: <span class="comment">/* package.json:version */</span>,</span><br><span class="line">    homepage: <span class="comment">/* package.json:homepage */</span>,</span><br><span class="line">    keyword: <span class="comment">/* package.json:pagehop.keyword */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="pagehop-getHops"><a href="#pagehop-getHops" class="headerlink" title="pagehop.getHops()"></a>pagehop.getHops()</h2><p>Returns a <strong>MUTABLE array</strong> of objects specifying addresses the user had “hopped of”. Recipes are usually using the hops array for a visual notification of which recipe is being used. Here is how you should use the hops array and how the objects in it look like:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">pagehop.getHops().push( &#123;</span><br><span class="line">    text: <span class="string">"RecipeId"</span>,</span><br><span class="line">    address: <span class="string">"http://some.url.com/will/produce/same/results/but/in-browser"</span></span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure>
<h2 id="pagehop-scrape-url-callback"><a href="#pagehop-scrape-url-callback" class="headerlink" title="pagehop.scrape( url, callback )"></a>pagehop.scrape( url, callback )</h2><ul>
<li><strong>url</strong> - <strong>string</strong> pointing to a file or a page on the web. Pagehop automatically will use the scrape.js script in a separate, also isolated, environment (browser), where it will first navigate to the page and then run scrape.js.</li>
<li><strong>callback</strong> - function accepting 2 arguments - <strong>error</strong> and <strong>result</strong>. If the scrape produced an error (syntax error in scrape.js, or runtime error, or timeout), you will get an error in the callback and no result. Error is of this structure:</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    type: <span class="comment">/* string */</span>,</span><br><span class="line">    message: <span class="comment">/* string */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The result object is always entirely up to your scrape script.</p>
<h2 id="experimental-pagehop-updateResults-results"><a href="#experimental-pagehop-updateResults-results" class="headerlink" title="(experimental) pagehop.updateResults( results )"></a>(experimental) pagehop.updateResults( results )</h2><ul>
<li><strong>results</strong> - <strong>array</strong> of objects with this structure:</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    text: <span class="comment">/* required, string */</span>,</span><br><span class="line">    address: <span class="comment">/* string, url */</span>,</span><br><span class="line">    displayText: <span class="comment">/* string that can contain html formatting */</span>,</span><br><span class="line">    displayAddress: <span class="comment">/* string that can contain html formatting */</span>,</span><br><span class="line">    tooltip: <span class="comment">/* string */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This is not yet used by official builds of Pagehop, but we are trying to see if we can show intermediate results before the recipe is finished. So far the tests don’t show too promising results, so we advice you not to use the method. Most likely we will try to replace this with something like % progress API, where you will tell Pagehop, what % of the scrapes/loads/generations of results are ready, so we can visualize it and notify the user.</p>
<p>If you decide to use it, anyway, you should call it in cases where you have called scrape in a synchronous loop. This way every time one of the scrapes is ready, it will notify Pagehop of the new results. <strong>Always return ALL of the results so far, not just these that you get on this callback from scrape</strong></p>
<h2 id="pagehop-finishWithError-error"><a href="#pagehop-finishWithError-error" class="headerlink" title="pagehop.finishWithError( error )"></a>pagehop.finishWithError( error )</h2><p>If your recipe is prevented by an obstacle that it cannot overcome you can fail gracefully with pagehop.finishWithError().</p>
<p>Error object must be with this structure:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    type: <span class="comment">/* string */</span>,</span><br><span class="line">    message: <span class="comment">/* string */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="pagehop-finish-results"><a href="#pagehop-finish-results" class="headerlink" title="pagehop.finish( results )"></a>pagehop.finish( results )</h2><ul>
<li><strong>results</strong> - <strong>array</strong> of result objects.</li>
</ul>
<p>When your recipe is ready, you can return the results it has obtained/produced with pagehop.finish( results ).</p>
<p>Here is how your result objects should look like:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    text: <span class="comment">/* required, string */</span>,</span><br><span class="line">    address: <span class="comment">/* string, url */</span>,</span><br><span class="line">    displayText: <span class="comment">/* string that can contain html formatting */</span>,</span><br><span class="line">    displayAddress: <span class="comment">/* string that can contain html formatting */</span>,</span><br><span class="line">    tooltip: <span class="comment">/* string */</span>,</span><br><span class="line">    preview: <span class="comment">/* string (html) */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If you provide, both, text and displayText, displayText will be shown as the first row of your Pagehop result, but text will still be the field used for searches (:r will not use the displayText to match against and the produced results will have their displayText fields redone with the formatting highlighting the matched parts). If only text is present, then it will be displayed on the first row.</p>
<p>If you provide, both, address and displayAddress, only displayAddress will be shown, on the second row.</p>
<p>By default, address is show in a tooltip on long-hover on items in the UI. You can pass a different tooltip text to replace it.</p>
<p>Starting from ver1.2, you can optionally supply a preview html to be loaded in Pagehop’s UI. Recipes such as DefineWord, CodeSearch and others use it. Local resources you reffer from this html should assume the recipe’s root dir as / (web root).</p>

      </div>
      <footer id="page-footer">
        <time id="page-footer-updated" datetime="2015-02-24T15:15:57.000Z" itemprop="dateModified">Last updated: Feb 24 2015</time>
        <a href="/package-json-recipe/" id="page-footer-prev" title="package.json">Prev</a><a href="/scrape-js/" id="page-footer-next" title="scrape.js">Next</a>
      </footer>
      
    </div>
    <aside id="sidebar">
  
    <strong class="sidebar-title">How to use</strong>
    
      <a href="/" class="sidebar-link">Install</a>
    
      <a href="/overview/" class="sidebar-link">Overview</a>
    
      <a href="/register-with-license-key/" class="sidebar-link">Register with License-key</a>
    
      <a href="/search/" class="sidebar-link">Search</a>
    
      <a href="/page-hopping/" class="sidebar-link">Page-hopping</a>
    
      <a href="/docs-browsing/" class="sidebar-link">Docs Browsing</a>
    
      <a href="/reading-news/" class="sidebar-link">Reading News</a>
    
      <a href="/quick-info/" class="sidebar-link">Quick Info</a>
    
      <a href="/3rd-party-recipes-and-tools/" class="sidebar-link">3rd party Recipes and Tools</a>
    
  
    <strong class="sidebar-title">Development</strong>
    
      <a href="/development-overview/" class="sidebar-link">Overview</a>
    
      <a href="/ecma-script/" class="sidebar-link">ECMAScript</a>
    
      <a href="/external-dependencies/" class="sidebar-link">External Dependencies</a>
    
  
    <strong class="sidebar-title">Develop Recipes</strong>
    
      <a href="/scaffold-recipe/" class="sidebar-link">Scaffold</a>
    
      <a href="/package-json-recipe/" class="sidebar-link">package.json</a>
    
      <a href="/page-loop-js/" class="sidebar-link current">page-loop.js</a>
    
      <a href="/scrape-js/" class="sidebar-link">scrape.js</a>
    
      <a href="/testing-recipes/" class="sidebar-link">Testing</a>
    
  
    <strong class="sidebar-title">Develop Tools</strong>
    
      <a href="/scaffold-tool/" class="sidebar-link">Scaffold</a>
    
      <a href="/package-json-tool/" class="sidebar-link">package.json</a>
    
      <a href="/tool-js/" class="sidebar-link">tool.js</a>
    
      <a href="/testing-tools/" class="sidebar-link">Testing</a>
    
  
    <strong class="sidebar-title">Used Software</strong>
    
      <a href="/used-software/" class="sidebar-link">Licenses</a>
    
  
    <strong class="sidebar-title">Misc</strong>
    
      <a href="/releases/" class="sidebar-link">Release History</a>
    
      <a href="/faq/" class="sidebar-link">F.A.Q.</a>
    
  
</aside>
  </div>
</article>
  <footer>
	<div class="container">
		<div class="row">
			<div class="col-md-4">
				<span class="copyright">Copyright &copy; <a href="http://universless.com">Universless Ltd.</a> 2015-2018</span>
			</div>
			<div class="col-md-4">
				<ul class="list-inline social-buttons">
					<li><a href="http://twitter.com/pagehopapp"><i class="fa fa-twitter"></i></a>
					</li>
					<li><a href="http://facebook.com/pagehop"><i class="fa fa-facebook"></i></a>
					</li>
					<li><a href="mailto:support@pagehopapp.com"><i class="fa fa-envelope"></i></a>
					</li>
				</ul>
			</div>
			<div class="col-md-4">
				<ul class="list-inline quicklinks">
					<li>
						<a href="#" data-target="#privacyPolicyModal" data-keyboard="true" data-toggle="modal">Privacy Policy</a>
					</li>
					<li>
						<a href="#" data-target="#eulaModal" data-keyboard="true" data-toggle="modal">EULA</a>
					</li>
					<li>
						<a href="http://pagehopapp.com/press">Press</a>
					</li>
				</ul>
			</div>
		</div>
	</div>
</footer>

<!-- Modals -->
<!-- PrivacyPolicy Modal -->
<div class="modal fade" id="privacyPolicyModal" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-content">
		<div class="close-modal" data-dismiss="modal">
			<div class="lr">
				<div class="rl">
				</div>
			</div>
		</div>
		<div class="container">
			<div class="row">
				<div class="col-lg-8 col-lg-offset-2">
					<div class="modal-body">
						<h1>Privacy Policy</h1>

						<h2>The information you provide to us</h2>
						<p>We take your privacy seriously. When you provide us with any personal information, we do our best to keep it safe. We will not share your personal information with third-parties other than our payment gateway and will take all reasonable precautions to protect it.</p>

						<p>Braintree Payments (our payment gateway) will be the only party receiving your payment data in case you purchase a license for Pagehop. Our servers will not receive any of this data, other than your email, your name and the text of your License Key (the one you receive through email upon purchase) in order to be able to resend you your License Key in case it's lost. Universless Ltd. is not and will not be responsible nor held liable for any security issues that Braintree Payments gateway has or will have in future.</p>

						<h2>Tracking and cookies</h2>
						<p>To help us understand how we can make Pagehop's website better, we use Google Analytics on pagehopapp.com, as well as on api.pagehopapp.com.</p>

						<p>This information is anonymous and does not provide us with identifiable information, but helps us ensure that our documentation pages answer all of the most popular questions correctly, for example.</p>

						<hr style="width:60%">
						<i>
							<p>By using the websites owned by Universless Ltd. (including pagehopapp.com, www.pagehopapp.com and api.pagehopapp.com), you agree to the Privacy Policy above.</p>

							<p>If you have any questions about our privacy policy, please contact us on support@pagehopapp.com.</p>
						</i>
						<button type="button" class="btn btn-primary pagehop-button" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- EULA Modal -->
<div class="modal fade" id="eulaModal" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-content">
		<div class="close-modal" data-dismiss="modal">
			<div class="lr">
				<div class="rl">
				</div>
			</div>
		</div>
		<div class="container">
			<div class="row">
				<div class="col-lg-8 col-lg-offset-2">
					<div class="modal-body">
						<h1>End-user license agreement (EULA)</h1>

						<p>The SOFTWARE PRODUCT (PAGEHOP) is protected by copyright laws and international copyright treaties, as well as other intellectual property laws and treaties. The SOFTWARE PRODUCT is licensed, not sold.
						</p>
						<ol>
							<li>LICENSES<br>
							PAGEHOP is licensed as follows:

								<ol type="a">
									<li>Installation and Usage.<br>
										Licenses are per user and valid for use on all supported operating systems. License keys may be used on multiple computers and operating systems, provided the license key holder is the primary user.
									</li>
									<li>Backup Copies.<br>
										You may make copies of the license key and or PAGEHOP for backup and archival purposes.
									</li>
								</ol>

							</li>
							<li>DESCRIPTION OF OTHER RIGHTS AND LIMITATIONS

								<ol type="a">
									<li>Maintenance of Copyright Notices.<br>
										You must not remove or alter any copyright notices on any copy of PAGEHOP.
									</li>
									<li>Distribution.<br>
										You may not distribute or sell license keys or PAGEHOP to third parties. Licenses will be revoked if distributed or sold to third parties.
									</li>
									<li>Rental.<br>
										You may not rent, lease, or lend the license key or PAGEHOP.
									</li>
								</ol>

							</li>
							<li>COPYRIGHT<br>
								All title, including but not limited to copyrights, in and to PAGEHOP and any copies thereof are owned by UNIVERSLESS LTD.
							</li>
							<li>NO WARRANTIES<br>
								UNIVERSLESS LTD expressly disclaims any warranty for PAGEHOP, which is provided 'as is' without any express or implied warranty of any kind, including but not limited to any warranties of merchantability, non-infringement, or fitness of a particular purpose.

							</li>
							<li>REFUNDS<br>
								Refunds are available within 10 days of purchasing. Please send us an email (support@pagehopapp.com) if you wish to claim a refund. Refund can't be claimed after the first 10 days.
							</li>
							<li>LIMITATION OF LIABILITY<br>
								In no event shall UNIVERSLESS LTD be liable for any damages due to use of PAGEHOP, to the maximum extent permitted by law. This includes without limitation, lost profits, business interruption, or lost information. In no event will UNIVERSLESS LTD be liable for loss of data or for indirect, special, incidental, consequential (including lost profit), or other damages. UNIVERSLESS LTD shall have no liability with respect to the content of PAGEHOP or any part thereof, including but not limited to errors or omissions contained therein, libel, trademark rights, business interruption, loss of privacy or the disclosure of confidential information.
							</li>
						</ol>
						<button type="button" class="btn btn-primary pagehop-button" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
  
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="/js/retina.min.js"></script>
<script src="/js/script.js"></script>
<!-- Google+ -->
<script type="text/javascript" src="//apis.google.com/js/plusone.js"></script>
<!-- Twitter -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Bootstrap Core JavaScript -->
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

<!-- Plugin JavaScript -->
<script src="/bower_components/jquery-easing/jquery.easing.min.js"></script>
<script src="/bower_components/classie/classie.js"></script>
<script src="/pagehopapp-scripts/cbpAnimatedHeader.js"></script>

<!-- Custom theme JavaScript -->
<script src="/pagehopapp-scripts/main.js"></script>
</body>
</html>